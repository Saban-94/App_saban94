<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>אזור אישי - ח.סבן</title>
    <meta name="theme-color" content="#ffffff"/>
    <!-- The manifest link that caused the error has been removed -->
    <link rel="apple-touch-icon" href="https://i.postimg.cc/2SbDgD1B/1.png">
    <link rel="icon" href="https://i.postimg.cc/2SbDgD1B/1.png">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>

    <!-- Fonts and Libraries -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        :root {
            --brand: #0b72b9; --accent: #ff9f1c; --bg: #f0f2f5; --card: #ffffff;
            --text-dark: #1a202c; --text-light: #4a5568; --text-muted: #718096;
            --border: #e2e8f0; --success: #38a169; --warning: #dd6b20; --danger: #e53e3e;
            --radius: 16px; --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Additional styles... */
    </style>
</head>
<body>
    <div id="app-container">
        <!-- App content will be rendered here -->
    </div>

    <script>
    (function() {
        const firebaseConfig = {
            apiKey: "AIzaSyDy3k1AoEKeuCKjmFxefn9fapeqv2Le1_w",
            authDomain: "hsaban94-cc777.firebaseapp.com",
            databaseURL: "https://hsaban94-cc777.firebaseio.com",
            projectId: "hsaban94-cc777",
            storageBucket: "hsaban94-cc777.firebasestorage.app",
            messagingSenderId: "299206369469",
            appId: "1:299206369469:web:6e8674eb787e52fa9457d4",
            measurementId: "G-105YLDL68F"
        };

        firebase.initializeApp(firebaseConfig);
        const messaging = firebase.messaging();

        function requestNotificationPermission(clientId) {
            messaging.requestPermission().then(() => {
                console.log('Notification permission granted.');
                return messaging.getToken();
            }).then(token => {
                console.log('FCM Token:', token);
                // Send this token to your server to save it
                google.script.run
                    .withSuccessHandler(() => console.log("Token saved successfully."))
                    .withFailureHandler(err => console.error("Error saving token: ", err))
                    .saveClientFCMToken(clientId, token);
            }).catch((err) => {
                console.log('Unable to get permission to notify.', err);
            });
        }
        
        function getClientIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('c');
        }

        // Initialize notification permission request after getting client ID
        document.addEventListener('DOMContentLoaded', () => {
            const clientId = getClientIdFromUrl();
            if (clientId) {
                // You might want to ask for permission at a more opportune time,
                // e.g., after the user logs in or performs an action.
                // For now, we ask immediately.
                setTimeout(() => requestNotificationPermission(clientId), 2000); // Delay to let the app load
            }
        });

        // The rest of your client-side application logic goes here...
        // For example, fetching client data, rendering the UI, etc.

    })();
    </script>
</body>
</html>

